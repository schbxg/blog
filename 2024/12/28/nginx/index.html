<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Nginx | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="安装信息获取 网关服务器，后端服务器的入口 反向代理服务器，代理Http请求，转发至后端服务器  Nginx安装信息获取 123456# 获取Nginx可执行文件路径whereis nginx# 获取Nginx配置文件路径huangxigan@DESKTOP-8059I68:~$ sudo nginx -tnginx: the configuration file &#x2F;etc&#x2F;nginx&#x2F;nginx">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx">
<meta property="og:url" content="https://github.com/schbxg/blog.git/blog/2024/12/28/nginx/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="安装信息获取 网关服务器，后端服务器的入口 反向代理服务器，代理Http请求，转发至后端服务器  Nginx安装信息获取 123456# 获取Nginx可执行文件路径whereis nginx# 获取Nginx配置文件路径huangxigan@DESKTOP-8059I68:~$ sudo nginx -tnginx: the configuration file &#x2F;etc&#x2F;nginx&#x2F;nginx">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://download.huawei.com/mdl/image/download?uuid=ddc6bc501def406188e2826d5ca316fe">
<meta property="og:image" content="https://download.huawei.com/mdl/image/download?uuid=9f3bc85199d645df98c241537b8795e5">
<meta property="og:image" content="https://github.com/blog/nginx.assets/image-20241130135508273.png">
<meta property="og:image" content="https://github.com/blog/nginx.assets/image-20241130135901291.png">
<meta property="article:published_time" content="2024-12-28T14:37:34.680Z">
<meta property="article:modified_time" content="2024-12-28T14:39:58.700Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://download.huawei.com/mdl/image/download?uuid=ddc6bc501def406188e2826d5ca316fe">
  
    <link rel="alternate" href="/blog/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/blog/favicon.png">
  
  
  
<link rel="stylesheet" href="/blog/css/style.css">

  
    
<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/blog/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://github.com/schbxg/blog.git/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-nginx" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2024/12/28/nginx/" class="article-date">
  <time class="dt-published" datetime="2024-12-28T14:37:34.680Z" itemprop="datePublished">2024-12-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Nginx
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="安装信息获取"><a href="#安装信息获取" class="headerlink" title="安装信息获取"></a>安装信息获取</h1><ul>
<li>网关服务器，后端服务器的入口</li>
<li>反向代理服务器，代理Http请求，转发至后端服务器</li>
</ul>
<p>Nginx安装信息获取</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取Nginx可执行文件路径</span></span><br><span class="line">whereis nginx</span><br><span class="line"><span class="comment"># 获取Nginx配置文件路径</span></span><br><span class="line">huangxigan@DESKTOP-8059I68:~$ <span class="built_in">sudo</span> nginx -t</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br></pre></td></tr></table></figure>

<h1 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定nginx运行的用户</span></span><br><span class="line">user www-data;</span><br><span class="line"><span class="comment"># 自动设置工作进程数</span></span><br><span class="line">worker_processes auto;</span><br><span class="line"><span class="comment"># 指定pid文件位置</span></span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line"><span class="comment">#include /etc/nginx/modules-enabled/*.conf;</span></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line"><span class="comment"># 设置单个工作进程最大连接数</span></span><br><span class="line">worker_connections 768;</span><br><span class="line"><span class="comment"># multi_accept on;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">  <span class="comment"># 使用操作系统直接在内核空间完成文件传输，</span></span><br><span class="line">  <span class="comment"># 避免内核空间到用户空间拷贝，提升文件传输性能</span></span><br><span class="line">  sendfile on;</span><br><span class="line">  </span><br><span class="line">  keepalive_timeout 100;</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 包含MIME类型配置文件。定义不同文件扩展名与内容类型的对应关系</span></span><br><span class="line">  <span class="comment"># nginx可正确设置响应头的conten-type，从而浏览器可正确解析和显示内容</span></span><br><span class="line">  include /etc/nginx/mime.types;</span><br><span class="line">  <span class="comment"># 在mime配置文件中找不到的采用以下默认配置</span></span><br><span class="line">  default_type application/octet-stream;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">##</span></span><br><span class="line">  <span class="comment"># SSL Settings</span></span><br><span class="line">  <span class="comment">##</span></span><br><span class="line">  </span><br><span class="line">  ssl_protocols TLSv1 TLSv1.1 TLSv1.2; <span class="comment"># Dropping SSLv3, ref: POODLE</span></span><br><span class="line">  ssl_prefer_server_ciphers on;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">##</span></span><br><span class="line">  <span class="comment"># Logging Settings</span></span><br><span class="line">  <span class="comment">##</span></span><br><span class="line">  </span><br><span class="line">  access_log /var/log/nginx/access.log;</span><br><span class="line">  error_log /var/log/nginx/error.log;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">##</span></span><br><span class="line">  <span class="comment"># Gzip Settings</span></span><br><span class="line">  <span class="comment">##</span></span><br><span class="line">  </span><br><span class="line">  gzip on;</span><br><span class="line"> </span><br><span class="line">  <span class="comment"># 虚拟主机，可配置多个虚拟主机,多个主机的端口不同</span></span><br><span class="line">  <span class="comment"># 一个虚拟主机下可以配置不同web</span></span><br><span class="line">  server</span><br><span class="line">  &#123;</span><br><span class="line">    listen [::]:80;</span><br><span class="line">    <span class="comment"># 域名、主机名</span></span><br><span class="line">    server_name www.test.com; <span class="comment"># 如何使用？</span></span><br><span class="line">    location /app1 &#123;</span><br><span class="line">		root /home/tls/web;</span><br><span class="line">		index index.html;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">     location /app2 &#123;</span><br><span class="line">		root /home/tls/web;</span><br><span class="line">		index index.html;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 上述APP1、APP2可以使用正则进行配置</span></span><br><span class="line">    location ~*/(app1|app2) &#123;</span><br><span class="line">    	root /home/tls/web;</span><br><span class="line">    	index index.html;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  server</span><br><span class="line">  &#123;</span><br><span class="line">    listen 8001;</span><br><span class="line">    location /var/www/mt &#123;</span><br><span class="line">        root /var/www/mt;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="动静分离"><a href="#动静分离" class="headerlink" title="动静分离"></a>动静分离</h1><p>动态资源其实就是指那些后台资源，而静态资源就是指HTML，JavaScript，CSS，img等文件。动静分离，说白了，就是将网站静态资源（HTML，JavaScript，CSS，img等文件）与后台应用分开部署，提高用户访问静态代码的速度，降低对后台应用服务器的请求。后台应用服务器只负责动态数据请求。</p>
<h2 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h2><p>动静分离就是根据一定规则静态资源的请求全部请求Nginx服务器，后台数据请求转发到Web应用服务器上。从而达到动静分离的目的。目前比较流行的做法是将静态资源部署在Nginx上，而Web应用服务器只处理动态数据请求。这样减少Web应用服务器的并发压力。具体如下图所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">A[Browser]--&gt;B[Nginx]</span><br><span class="line">B--&gt;C[Web应用服务器-tomcat]</span><br><span class="line">B--&gt;D[Static Resources]</span><br></pre></td></tr></table></figure>

<h2 id="配置动静分离"><a href="#配置动静分离" class="headerlink" title="配置动静分离"></a>配置动静分离</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line"></span><br><span class="line">   server &#123;</span><br><span class="line">       listen       80;</span><br><span class="line">       server_name  localhost;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">#拦截后台请求</span></span><br><span class="line">      location / &#123;</span><br><span class="line">      	<span class="comment"># 后端web服务</span></span><br><span class="line">        proxy_pass http://localhost:81;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">#拦截静态资源，可以使用正则表达式方式进行匹配</span></span><br><span class="line">      location ~ .*\.(html|htm|gif|jpg|jpeg|bmp|png|ico|js|css)$ &#123;</span><br><span class="line">        root static;</span><br><span class="line">        expires      30d;  </span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="防盗链"><a href="#防盗链" class="headerlink" title="防盗链"></a>防盗链</h1><p>不允许盗图</p>
<h1 id="Keepalived"><a href="#Keepalived" class="headerlink" title="Keepalived"></a>Keepalived</h1><p>Keepalived 高可用服务对之间的故障切换转移，是通过 VRRP（Virtual Router Redundancy Protocol , 虚拟路由器冗余协议）来切换的；<br>在 Keepalived 服务正常工作时，主 Master 节点会不断地向备节点发送（默认多播的方式）心跳消息，用以告诉备 Backup 节点自己还活着，当主 Master 节点发生故障时，就无法发送心跳消息，备节点也就因此无法继续检测到来自主 Master 节点的心跳了，于是调用自身的接管程序，接管主 Master 节点的 IP 资源及服务，而当主 Master 节点恢复时，备 Backup 节点又会释放主节点故障时自身接管的 IP 资源及服务，恢复到原来的备用角色。</p>
<h2 id="虚拟IP"><a href="#虚拟IP" class="headerlink" title="虚拟IP"></a>虚拟IP</h2><h2 id="VRRP"><a href="#VRRP" class="headerlink" title="VRRP"></a>VRRP</h2><p>虚拟路由冗余协议VRRP（Virtual Router Redundancy Protocol）是一种用于提高网络可靠性的容错协议。通过VRRP，可以在主机的下一跳设备出现故障时，及时将业务切换到备份设备，从而保障网络通信的连续性和可靠性。</p>
<h3 id="VRRP的三种状态"><a href="#VRRP的三种状态" class="headerlink" title="VRRP的三种状态"></a>VRRP的三种状态</h3><p>VRRP协议中定义了三种状态机：初始状态（Initialize）、活动状态（Master）、备份状态（Backup）。其中，只有处于Master状态的设备才可以转发那些发送到虚拟<a target="_blank" rel="noopener" href="https://info.support.huawei.com/info-finder/encyclopedia/zh/IPv4.html">IP地址</a>的报文。下表详细描述了三种状态。</p>
<p><strong>表1-1</strong> VRRP协议状态</p>
<table>
<thead>
<tr>
<th>状态</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Initialize</td>
<td>该状态为VRRP不可用状态，在此状态时设备不会对VRRP通告报文做任何处理。通常设备启动时或设备检测到故障时会进入Initialize状态。</td>
</tr>
<tr>
<td>Master</td>
<td>当VRRP设备处于Master状态时，它将会承担虚拟路由设备的所有转发工作，并定期向整个虚拟内发送VRRP通告报文。</td>
</tr>
<tr>
<td>Backup</td>
<td>当VRRP设备处于Backup状态时，它不会承担虚拟路由设备的转发工作，并定期接受Master设备的VRRP通告报文，判断Master的工作状态是否正常。</td>
</tr>
</tbody></table>
<h3 id="VRRP选举机制"><a href="#VRRP选举机制" class="headerlink" title="VRRP选举机制"></a>VRRP选举机制</h3><img src="https://download.huawei.com/mdl/image/download?uuid=ddc6bc501def406188e2826d5ca316fe" alt="Master设备选举过程" style="zoom: 80%;" />

<h3 id="VRRP工作原理"><a href="#VRRP工作原理" class="headerlink" title="VRRP工作原理"></a>VRRP工作原理</h3><p>由几台<a target="_blank" rel="noopener" href="https://info.support.huawei.com/info-finder/encyclopedia/zh/%E8%B7%AF%E7%94%B1%E5%99%A8.html">路由器</a>组成的<a target="_blank" rel="noopener" href="https://info.support.huawei.com/info-finder/encyclopedia/zh/%E8%99%9A%E6%8B%9F%E8%B7%AF%E7%94%B1%E5%99%A8.html">虚拟路由器</a>又称为VRRP备份组。一个VRRP备份组在逻辑上为一台路由器。VRRP备份组建立后，各设备会根据所配置的优先级来选举Master设备，选举方式如下图所示。</p>
<img src="https://download.huawei.com/mdl/image/download?uuid=9f3bc85199d645df98c241537b8795e5" alt="VRRP工作原理" style="zoom:80%;" />

<p>当Master设备出现故障时，路由器B和路由器C会选举出新的Master设备。新的Master设备开始响应对虚拟IP地址的<a target="_blank" rel="noopener" href="https://info.support.huawei.com/info-finder/encyclopedia/zh/ARP.html">ARP</a>响应，并定期发送VRRP通告报文。</p>
<p>VRRP的详细工作过程如下：</p>
<ol>
<li>VRRP备份组中的设备根据优先级选举出Master。Master设备通过发送<a target="_blank" rel="noopener" href="https://info.support.huawei.com/info-finder/encyclopedia/zh/ARP.html">免费ARP</a>报文，将虚拟MAC地址通知给与它连接的设备或者主机，从而承担报文转发任务。</li>
<li>Master设备周期性向备份组内所有Backup设备发送VRRP通告报文，通告其配置信息（优先级等）和工作状况。</li>
<li>如果Master设备出现故障，VRRP备份组中的Backup设备将根据优先级重新选举新的Master。</li>
<li>VRRP备份组状态切换时，Master设备由一台设备切换为另外一台设备，新的Master设备会立即发送携带虚拟路由器的虚拟MAC地址和虚拟IP地址信息的免费ARP报文，刷新与它连接的设备或者主机的MAC表项，从而把用户流量引到新的Master设备上来，整个过程对用户完全透明。</li>
<li>原Master设备故障恢复时，若该设备为IP地址拥有者（优先级为255），将直接切换至Master状态。若该设备优先级小于255，将首先切换至Backup状态，且其优先级恢复为故障前配置的优先级。</li>
<li>Backup设备的优先级高于Master设备时，由Backup设备的工作方式（抢占方式和非抢占方式）决定是否重新选举Master。</li>
</ol>
<h3 id="VRRP应用场景"><a href="#VRRP应用场景" class="headerlink" title="VRRP应用场景"></a>VRRP应用场景</h3><p>在网络中，VRRP不仅仅在设备故障时触发Master设备的切换，它也能感知某个接口、某条路由的状态。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="https://info.support.huawei.com/info-finder/encyclopedia/zh/VRRP.html">https://info.support.huawei.com/info-finder/encyclopedia/zh/VRRP.html</a></p>
<h2 id="业务虚拟IP实现原理"><a href="#业务虚拟IP实现原理" class="headerlink" title="业务虚拟IP实现原理"></a>业务虚拟IP实现原理</h2><p>启动一个Elect进程，以MAC地址最小的为VIP挂载点节点，当该虚拟IP挂载节点Elect进程挂掉之后，会触发再次选举。</p>
<blockquote>
<p>此Elect进程的功能相当于Keepalived进程的功能</p>
</blockquote>
<h2 id="业务Redis主库选举实现原理"><a href="#业务Redis主库选举实现原理" class="headerlink" title="业务Redis主库选举实现原理"></a>业务Redis主库选举实现原理</h2><p>采用投票机制，投票的条件是数据版本号、MAC地址大小。在选举Redis主节点时，首先检测数据版本号是否最大，最大代表最新，最优先被选为主节点。若数据版本号一致，则选举MAC地址最小的节点为主节点。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">A([开始]) --&gt; B(检查数据版本号大小)</span><br><span class="line">B --&gt;C&#123;数据版本号最大&#125;</span><br><span class="line">C--&gt;|Yes| D(选举为主节点)</span><br><span class="line">C--&gt;|No|C1&#123;数据版本号相等&#125;</span><br><span class="line">C1--&gt;|No,小于其他节点|E1</span><br><span class="line">C1--&gt;|Yes|E(检查MAC大小)</span><br><span class="line">E1(被设置为从节点)--&gt;G</span><br><span class="line"></span><br><span class="line">E--&gt;F&#123;MAC地址最小&#125;</span><br><span class="line">F--&gt;|Yes|D</span><br><span class="line">F--&gt;|No|E1</span><br><span class="line">D--&gt;G([结束])</span><br></pre></td></tr></table></figure>

<p>主库选举出的主节点负责设置VIP。</p>
<blockquote>
<p>业务VIP选举可使用Keepalived进行虚拟IP切换。</p>
</blockquote>
<h1 id="测试工具"><a href="#测试工具" class="headerlink" title="测试工具"></a>测试工具</h1><h2 id="使用curl测试"><a href="#使用curl测试" class="headerlink" title="使用curl测试"></a>使用curl测试</h2><h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><p>HTTP协议是明文传输，不安全，通常可以采用凯撒加密算法，服务端通过凯撒算法进行解密。（对称加密）</p>
<p>对称加密，需要内置在服务端，不安全，容易截获。</p>
<p>非对称加密，必须保证私钥安全，公钥不能解密。公钥、私钥其实就是加密因子，是一种加密密码。HTTPS基于非对称加密实现。</p>
<p>非对称加密也不安全，可能存在中间服务器，发送公钥，骗取客户端的信任。</p>
<p><img src="/blog/nginx.assets/image-20241130135508273.png" alt="image-20241130135508273"></p>
<p><img src="/blog/nginx.assets/image-20241130135901291.png" alt="image-20241130135901291"></p>
<p>CA证书，CA证书内置在操作系统</p>
<h2 id="自签名"><a href="#自签名" class="headerlink" title="自签名"></a>自签名</h2><h3 id="OpenSSL"><a href="#OpenSSL" class="headerlink" title="OpenSSL"></a>OpenSSL</h3><h2 id="在线证书申请"><a href="#在线证书申请" class="headerlink" title="在线证书申请"></a>在线证书申请</h2><h1 id="Nginx高并发架构设计"><a href="#Nginx高并发架构设计" class="headerlink" title="Nginx高并发架构设计"></a>Nginx高并发架构设计</h1><h2 id="扩容提升整体吞吐量"><a href="#扩容提升整体吞吐量" class="headerlink" title="扩容提升整体吞吐量"></a>扩容提升整体吞吐量</h2><p>扩容方式</p>
<ol>
<li>单机<strong>垂直</strong>扩容：硬件资源增加</li>
<li>水平扩展：集群化</li>
<li>细粒度拆分：分布式<ol>
<li>数据分区</li>
<li>上游服务SOA化（原生支持水平&#x2F;垂直扩容）</li>
<li>入口细分<ol>
<li>浏览器</li>
<li>移动端原生App（物联网）</li>
<li>H5内嵌式应用</li>
</ol>
</li>
</ol>
</li>
<li>数据异构化<ol>
<li>多级缓存<ol>
<li>客户端缓存</li>
<li>CDN缓存</li>
<li>异地多活</li>
<li>Nginx缓存</li>
</ol>
</li>
</ol>
</li>
<li>服务异步化<ol>
<li>拆分请求</li>
<li>消息中间件</li>
</ol>
</li>
</ol>
<p>扩容原则</p>
<ol>
<li>无状态原则</li>
<li>弹性原则</li>
</ol>
<blockquote>
<p>垂直扩容，类似挖单口井，继续深挖，以便于出更多的水；水平扩展，类似挖许多口井，以便于出更多的水。</p>
</blockquote>
<p>集群化，每一台服务器的代码，程序都是一样的。分布式，各个服务器负责一个业务模块，程序不一样。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/schbxg/blog.git/blog/2024/12/28/nginx/" data-id="cm58aghsh0002ztx0gm5m1s0o" data-title="Nginx" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/blog/2024/12/28/test1/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">test1</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/12/">December 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2024/12/28/nginx/">Nginx</a>
          </li>
        
          <li>
            <a href="/blog/2024/12/28/test1/">test1</a>
          </li>
        
          <li>
            <a href="/blog/2024/12/28/Session%E7%AE%A1%E7%90%86/">Session管理</a>
          </li>
        
          <li>
            <a href="/blog/2024/12/28/test/">test</a>
          </li>
        
          <li>
            <a href="/blog/2024/12/28/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/blog/js/jquery-3.6.4.min.js"></script>



  
<script src="/blog/fancybox/jquery.fancybox.min.js"></script>




<script src="/blog/js/script.js"></script>





  </div>
</body>
</html>